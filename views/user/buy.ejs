<% layout("layouts/boilerplate2.ejs") %>
<style>
  .container{
    margin-top: 5rem;
  }
  .confirm {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .buy, .cancel {
    font-size: 0.95rem;
    width: fit-content;
  }

  @media (max-width: 576px) {
    .confirm {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    .buy, .cancel {
      width: 100%;
      justify-content: center;
    }
  }
</style>


<!--  Booking Form -->
<form
  action="/listings/<%= currUser._id %>/rent"
  method="POST"
  class="container mt-5 p-4 rounded shadow-sm bg-white needs-validation"
  style="max-width: 700px; margin: auto;"
  novalidate
>
  <!-- Header -->
  <h3 class="text-center mb-3 fw-bold">Request to Book</h3>

  <!-- Free Cancellation Notice -->
  <h6 class="text-center text-muted mb-4">
    Free cancellation before 
    <strong>
      <%= new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toLocaleDateString('en-IN', { dateStyle: 'medium' }) %>
    </strong>
  </h6>


  <!--  Personal Info -->

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <label for="fullName" class="form-label">Full Name</label>
      <input
        type="text"
        class="form-control"
        id="fullName"
        name="fullName"
        placeholder="Enter Full Name"
        required
      >
    </div>
    <div class="col-md-6">
      <label for="email" class="form-label">Email Address</label>
      <input
        type="email"
        class="form-control"
        id="email"
        name="email"
        placeholder="Enter Email"
        required
      >
    </div>
  </div>


  <!--  Contact & Guest Info -->

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <label for="phone" class="form-label">Phone Number</label>
      <input
        type="tel"
        class="form-control"
        id="phone"
        name="phone"
        placeholder="Enter Phone Number"
        required
      >
    </div>
    <div class="col-md-6">
      <label for="guests" class="form-label">Number of Guests</label>
      <input
        type="number"
        class="form-control"
        id="guests"
        name="guests"
        min="1"
        placeholder="Guests"
        required
      >
    </div>
  </div>


  <!--  Date Info -->

  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <label for="checkIn" class="form-label">Check-in Date</label>
      <input
        type="date"
        class="form-control"
        id="checkIn"
        name="checkIn"
        required
      >
    </div>
    <div class="col-md-6">
      <label for="checkOut" class="form-label">Check-out Date</label>
      <input
        type="date"
        class="form-control"
        id="checkOut"
        name="checkOut"
        required
      >
    </div>
    <div class="col-md-6">
  <div class="form-check">
    <input
      type="checkbox"
      class="form-check-input"
      id="termsCheckbox"
      name="termsCheckbox"
      required
    >
    <label class="form-check-label" for="termsCheckbox">
      I agree to the <a href="/terms" target="_blank">Terms and Conditions</a>
    </label>
  </div>
</div>

  </div>


  <!--  Confirm Buttons -->
  <div class="row confirm mt-4">
    <div class="col-12 col-md-6 d-flex justify-content-md-end justify-content-center mb-2 mb-md-0">
      <button type="submit" class="btn btn-primary buy px-4 py-2 fw-semibold w-100 w-md-auto">
        <i class="bi bi-send-fill me-2"></i> Confirm Booking
      </button>
    </div>
    <div class="col-12 col-md-6 d-flex justify-content-md-start justify-content-center">
      <a href="/listings" class="btn btn-outline-secondary cancel px-4 py-2 fw-semibold w-100 w-md-auto">
        Cancel
      </a>
    </div>
  </div>
</form>
<script>
  // Example starter JavaScript for disabling form submissions if there are invalid fields
(() => {
  'use strict'

  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  const forms = document.querySelectorAll('.needs-validation')

  // Loop over them and prevent submission
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }

      form.classList.add('was-validated')
    }, false)
  })
})()


  const checkIn = document.getElementById('checkIn');
  const checkOut = document.getElementById('checkOut');

  const today = new Date().toISOString().split('T')[0];
  checkIn.min = today;
  checkOut.min = today;

  checkIn.addEventListener('change', () => {
    checkOut.min = checkIn.value;
  });

</script>
